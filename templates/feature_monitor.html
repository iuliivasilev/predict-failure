{% extends "base.html" %}
{% block content %}
<div class="monitor-form">
    <form method="get" action="{{ url_for('feature_monitor') }}">
        <label for="collector">Тип оборудования:</label>
        <select name="collector" id="collector" onchange="this.form.submit()">
            {% for c in collectors %}
            <option value="{{ c }}" {% if c == selected_collector %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
        &nbsp;&nbsp;
        <label for="feature">Признак:</label>
        <select name="feature" id="feature" onchange="this.form.submit()">
            {% for f in features %}
            <option value="{{ f }}" {% if f == selected_feature %}selected{% endif %}>{{ f }}</option>
            {% endfor %}
        </select>
    </form>
</div>
<div class="chart-container">
    <canvas id="featureChart"></canvas>
</div>
<script>
    const chartData = {{chart_data|tojson}};
    if (chartData) {
        const ctx = document.getElementById('featureChart').getContext('2d');
        const data = {
            labels: chartData.timestamps.map(ts => {
                const d = new Date(ts * 1000);
                return d.toLocaleString();
            }),
            datasets: [{
                label: '{{ selected_feature }}',
                data: chartData.values,
                borderColor: '#7ecfff',
                backgroundColor: 'rgba(126,207,255,0.2)',
                tension: 0.2,
                pointRadius: 2,
            }]
        };
        new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: '#eee' } }
                },
                scales: {
                    x: { ticks: { color: '#eee' } },
                    y: { ticks: { color: '#eee' } }
                }
            }
        });
    }
</script>
{% endblock %}